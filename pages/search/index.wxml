<!--pages/search/index.wxml-->
<view class="container">
  <!-- 搜索框 -->
  <view class="search-header">
    <view class="search-box">
      <input 
        class="search-input"
        type="text"
        placeholder="搜索文章标题、内容..."
        value="{{keyword}}"
        bindinput="onKeywordInput"
        bindconfirm="onSearch"
        focus="{{autoFocus}}"
        confirm-type="search"
      />
      <view class="search-btn" bindtap="onSearch">
        <text class="search-icon">🔍</text>
      </view>
    </view>
    
    <!-- 搜索历史 -->
    <view wx:if="{{searchHistory.length > 0 && !keyword && !hasSearched}}" class="search-history">
      <view class="history-header">
        <text class="history-title">搜索历史</text>
        <text class="history-clear" bindtap="clearHistory">清空</text>
      </view>
      <view class="history-tags">
        <view 
          wx:for="{{searchHistory}}" 
          wx:key="*this"
          class="history-tag"
          bindtap="onHistoryTap"
          data-keyword="{{item}}"
        >
          {{item}}
        </view>
      </view>
    </view>
    
    <!-- 热门搜索 -->
    <view wx:if="{{hotKeywords.length > 0 && !keyword && !hasSearched}}" class="hot-search">
      <view class="hot-header">
        <text class="hot-title">热门搜索</text>
      </view>
      <view class="hot-tags">
        <view 
          wx:for="{{hotKeywords}}" 
          wx:key="*this"
          class="hot-tag"
          bindtap="onHotKeywordTap"
          data-keyword="{{item}}"
        >
          {{item}}
        </view>
      </view>
    </view>
  </view>
  
  <!-- 搜索结果 -->
  <view wx:if="{{hasSearched}}" class="search-results">
    <!-- 搜索统计 -->
    <view class="search-stats">
      <text class="stats-text">找到 {{totalCount}} 篇相关文章</text>
      <text wx:if="{{keyword}}" class="stats-keyword">"{{keyword}}"</text>
    </view>
    
    <!-- 文章列表 -->
    <view wx:if="{{posts.length > 0}}" class="posts-list">
      <view 
        wx:for="{{posts}}" 
        wx:key="id"
        class="post-card"
        bindtap="onPostTap"
        data-slug="{{item.slug}}"
        data-id="{{item.id}}"
      >
        <!-- 封面图 -->
        <image 
          wx:if="{{item.pageCoverThumbnail}}"
          class="post-cover" 
          src="{{item.pageCoverThumbnail}}" 
          mode="aspectFill"
          lazy-load
        />
        
        <view class="post-content">
          <!-- 标题（高亮关键词） -->
          <view class="post-title">
            <rich-text nodes="{{item.highlightTitle || item.title}}"></rich-text>
          </view>
          
          <!-- 摘要（高亮关键词） -->
          <view wx:if="{{item.summary}}" class="post-summary">
            <rich-text nodes="{{item.highlightSummary || item.summary}}"></rich-text>
          </view>
          
          <!-- 元信息 -->
          <view class="post-meta">
            <view class="meta-item">
              <text class="meta-icon">📅</text>
              <text class="meta-text">{{item.publishDate}}</text>
            </view>
            
            <view wx:if="{{item.category}}" class="meta-item">
              <text class="meta-icon">📂</text>
              <text class="meta-text">{{item.category}}</text>
            </view>
          </view>
          
          <!-- 标签 -->
          <view wx:if="{{item.tags && item.tags.length > 0}}" class="post-tags">
            <view 
              wx:for="{{item.tags}}" 
              wx:for-item="tag"
              wx:key="*this"
              class="tag"
              style="background-color: {{tag.color || '#e3f2fd'}}"
            >
              {{tag.name || tag}}
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 加载更多 -->
    <view wx:if="{{posts.length > 0 && hasMore}}" class="load-more">
      <view wx:if="{{loadingMore}}" class="loading-more">
        <view class="loading-spinner"></view>
        <text class="loading-text">加载中...</text>
      </view>
      <view wx:else class="load-more-btn" bindtap="loadMore">
        <text>加载更多</text>
      </view>
    </view>
    
    <!-- 空结果 -->
    <view wx:if="{{posts.length === 0 && !loading}}" class="empty-result">
      <view class="empty-icon">🔍</view>
      <view class="empty-text">没有找到相关文章</view>
      <view class="empty-tips">试试其他关键词吧</view>
    </view>
  </view>
  
  <!-- 搜索建议（未搜索时） -->
  <view wx:if="{{!hasSearched}}" class="search-suggestions">
    <view class="suggestion-item">
      <text class="suggestion-icon">💡</text>
      <text class="suggestion-text">输入关键词搜索文章</text>
    </view>
    <view class="suggestion-item">
      <text class="suggestion-icon">🏷️</text>
      <text class="suggestion-text">支持搜索标题、内容、标签</text>
    </view>
    <view class="suggestion-item">
      <text class="suggestion-icon">⚡</text>
      <text class="suggestion-text">实时搜索，快速定位</text>
    </view>
  </view>
  
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-spinner"></view>
    <view class="loading-text">搜索中...</view>
  </view>
  
  <!-- 错误状态 -->
  <view wx:if="{{error}}" class="error">
    <view class="error-icon">😕</view>
    <view class="error-text">{{error}}</view>
    <button class="btn btn-primary" bindtap="retry">重试</button>
  </view>
</view>